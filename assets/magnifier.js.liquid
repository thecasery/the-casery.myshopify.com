$(document).ready(function(){
  $('.magnifier-cover').draggable({
    containment: ".magnifier-wholepic",
    scroll: false,
    cursor: "all-scroll",
    drag: function(event, ui){
    	var pos_left = ui.offset.left - $('.magnifier-wholepic').offset().left;
    	var pos_top = ui.offset.top - $('.magnifier-wholepic').offset().top;
    	var small_width = $('.magnifier-wholepic').width();
    	var small_height = $('.magnifier-wholepic').height();

    	var mag = $('#slider').slider('value');
    	var large_width = small_width * mag / 10;
    	var large_height = small_height * mag / 10;

      $('.magnifier-cover').width(4000/mag);
      $('.magnifier-cover').height(6000/mag);

    	$('.magnifier-preview__pic').width(large_width);
    	$('.magnifier-preview__pic').height(large_height);

    	var margin_left = 0 - pos_left * large_width / small_width;
    	var margin_top = 0 - pos_top * large_height / small_height;

    	$('.magnifier-preview__pic').css('margin-left', margin_left);
    	$('.magnifier-preview__pic').css('margin-top', margin_top);
    }
  });

  $('#slider').slider({
  	max: 50,
  	min: 10,
  	value: 20,
  	slide: function( event, ui ) {
  		var pos_left = $('.magnifier-cover').offset().left - $('.magnifier-wholepic').offset().left;
    	var pos_top = $('.magnifier-cover').offset().top - $('.magnifier-wholepic').offset().top;
    	var small_width = $('.magnifier-wholepic').width();
    	var small_height = $('.magnifier-wholepic').height();

    	var large_width = small_width * ui.value / 10;
    	var large_height = small_height * ui.value / 10;

    	$('.magnifier-preview__pic').width(large_width);
    	$('.magnifier-preview__pic').height(large_height);

      $('.magnifier-cover').width(4000/ui.value);
      $('.magnifier-cover').height(6000/ui.value);

    	var margin_left = 0 - pos_left * large_width / small_width;
    	var margin_top = 0 - pos_top * large_height / small_height;

    	$('.magnifier-preview__pic').css('margin-left', margin_left);
    	$('.magnifier-preview__pic').css('margin-top', margin_top);
  	}
  });
});